<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Progressive-Web-App & mobile friendliness -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <title>Admin Login ‚Äì Warm Delights Global Storage</title>

    <!-- Google Fonts (same stack as dashboard) -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <style>
        /* ---------- THEME VARIABLES (shared with dashboard) ---------- */
        :root{
            --primary-pink:#e8a5b7;
            --secondary-pink:#f4c2c2;
            --dark-pink:#d67b8a;
            --light-pink:#fdf2f8;
            --text-dark:#4a2e38;
            --text-light:#6b4e57;
            --white:#ffffff;
            --success:#4caf50;
            --error:#f44336;
            --shadow:0 4px 6px rgba(0,0,0,.1);
        }

        /* ---------- RESET ---------- */
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

        body{
            font-family:"Open Sans",sans-serif;
            background:var(--light-pink);
            color:var(--text-dark);
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:20px;
        }

        /* ---------- LOGIN CARD ---------- */
        .login-card{
            width:100%;
            max-width:420px;
            background:var(--white);
            border-radius:15px;
            padding:40px 30px 35px;
            box-shadow:var(--shadow);
            position:relative;
            overflow:hidden;
            animation:fadeIn .6s ease;
        }

        .login-card::before{
            content:'';
            position:absolute;
            top:0;left:0;right:0;
            height:4px;
            background:linear-gradient(90deg,var(--primary-pink),var(--dark-pink));
        }

        .login-card h1{
            text-align:center;
            font-size:1.6rem;
            font-weight:700;
            margin-bottom:25px;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            color:var(--primary-pink);
        }

        /* Logo placeholder (optional) */
        .login-logo{
            width:70px;
            height:70px;
            border-radius:50%;
            object-fit:cover;
            border:3px solid rgba(0,0,0,.05);
            display:block;
            margin:0 auto 15px;
        }

        /* ---------- FORM ---------- */
        .input-group{
            margin-bottom:22px;
            position:relative;
        }

        .input-group label{
            display:block;
            font-weight:600;
            margin-bottom:8px;
            font-size:.9rem;
        }

        .input-group input{
            width:100%;
            padding:12px 14px;
            border:2px solid var(--secondary-pink);
            border-radius:10px;
            font-size:.95rem;
            transition:border-color .3s,box-shadow .3s;
        }

        .input-group input:focus{
            outline:none;
            border-color:var(--primary-pink);
            box-shadow:0 0 0 3px rgba(232,165,183,.25);
        }

        /* Show/Hide toggle */
        .toggle-password{
            position:absolute;
            top:36px;
            right:14px;
            font-size:1rem;
            cursor:pointer;
            user-select:none;
            color:var(--text-light);
        }

        .remember-line{
            display:flex;
            align-items:center;
            gap:8px;
            font-size:.85rem;
            margin-bottom:20px;
        }

        /* ---------- BUTTON ---------- */
        .btn{
            width:100%;
            padding:14px;
            border:none;
            border-radius:25px;
            background:linear-gradient(135deg,var(--primary-pink),var(--dark-pink));
            color:var(--white);
            font-weight:700;
            font-size:1rem;
            cursor:pointer;
            transition:transform .25s,box-shadow .25s;
        }

        .btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(232,165,183,.4)}
        .btn:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}

        /* ---------- STATUS & CONNECTION ---------- */
        .status-message{
            margin-top:18px;
            padding:12px 15px;
            border-radius:10px;
            font-weight:600;
            display:flex;
            align-items:center;
            gap:10px;
            font-size:.9rem;
            border:2px solid transparent;
        }
        .status-message.success{background:#e8f5e8;border-color:var(--success);color:var(--success)}
        .status-message.error{background:#ffeaea;border-color:var(--error);color:var(--error)}
        .status-message.info{background:#e3f2fd;border-color:#2196f3;color:#1565c0}

        .connection-pill{
            position:fixed;
            top:10px;
            left:50%;
            transform:translateX(-50%);
            background:var(--success);
            color:#fff;
            padding:4px 12px;
            border-radius:20px;
            font-size:.75rem;
            font-weight:600;
            display:flex;
            align-items:center;
            gap:6px;
            z-index:1000;
            animation:pillPulse 2s infinite;
        }
        .dot{width:8px;height:8px;border-radius:50%;background:#4caf50}

        .offline{background:var(--error)!important}
        .offline .dot{background:var(--error)!important;animation:none}

        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
        @keyframes pillPulse{0%,100%{opacity:1}50%{opacity:.75}}

        /* ---------- RESPONSIVE ---------- */
        @media(max-width:480px){
            .login-card{padding:30px 25px}
        }
    </style>
</head>

<body>
    <!-- Connection indicator -->
    <div id="connectionStatus" class="connection-pill">
        <span class="dot"></span> Online
    </div>

    <!-- Login Card -->
    <div class="login-card">
        <img src="Logo.png" alt="Warm Delights Logo" class="login-logo" />
        <h1>üßÅ Admin Login</h1>

        <form id="loginForm" autocomplete="off">
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Admin username" required />
            </div>

            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Password" required minlength="6" />
                <span id="togglePwd" class="toggle-password">üëÅÔ∏è</span>
            </div>

            <div class="remember-line">
                <input type="checkbox" id="rememberMe" />
                <label for="rememberMe">Remember me (2 h session)</label>
            </div>

            <button type="submit" id="loginBtn" class="btn">Login</button>

            <div id="statusBox"></div>
        </form>
    </div>

    <!-- ---------- SCRIPTS ---------- -->
    <script>
        /* ---------- CONFIG ---------- */
        const API_CONFIG = {
            BACKEND_URL:
                location.hostname === "localhost"
                    ? "http://localhost:5000"
                    : "https://warm-delights-backend-production.up.railway.app",
        };

        /* ---------- DOM REFS ---------- */
        const form = document.getElementById("loginForm");
        const loginBtn = document.getElementById("loginBtn");
        const statusBox = document.getElementById("statusBox");
        const togglePwd = document.getElementById("togglePwd");
        const connectionStatus = document.getElementById("connectionStatus");

        /* ---------- HELPERS ---------- */
        function showStatus(msg, type = "info", duration = 5000) {
            statusBox.innerHTML = `
                <div class="status-message ${type}">
                    ${type === "success" ? "‚úÖ" : type === "error" ? "‚ùå" : "‚ÑπÔ∏è"}
                    <span>${msg}</span>
                </div>`;
            if (duration)
                setTimeout(() => (statusBox.innerHTML = ""), duration);
        }

        async function pingBackend() {
            try {
                await fetch(API_CONFIG.BACKEND_URL + "/health", { mode: "cors" });
                connectionStatus.classList.remove("offline");
                connectionStatus.querySelector("span:last-child").textContent =
                    "Online";
            } catch (_) {
                connectionStatus.classList.add("offline");
                connectionStatus.querySelector("span:last-child").textContent =
                    "Offline";
            }
        }

        /* ---------- LOGIN LOGIC ---------- */
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            loginBtn.disabled = true;
            loginBtn.textContent = "Logging in‚Ä¶";
            showStatus("Authenticating‚Ä¶", "info");

            const body = {
                username: document.getElementById("username").value.trim(),
                password: document.getElementById("password").value,
            };

            try {
                const res = await fetch(
                    API_CONFIG.BACKEND_URL + "/api/admin/login",
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(body),
                    }
                );

                const data = await res.json();

                if (!res.ok || !data.success) {
                    throw new Error(
                        data.message || "Invalid credentials"
                    );
                }

                /* ---------- STORE SESSION ---------- */
                localStorage.setItem("isWarmDelightsAdmin", "true");
                localStorage.setItem("adminSession", data.token);
                localStorage.setItem(
                    "adminLoginTime",
                    new Date().toISOString()
                );

                if (document.getElementById("rememberMe").checked) {
                    // persist token; already in localStorage
                }

                showStatus("Login successful! Redirecting‚Ä¶", "success", 1500);
                setTimeout(() => (location.href = "admin-dashboard.html"), 1200);
            } catch (err) {
                console.error(err);
                showStatus(err.message, "error");
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = "Login";
            }
        });

        /* ---------- UI ENHANCEMENTS ---------- */
        togglePwd.addEventListener("click", () => {
            const pwdField = document.getElementById("password");
            pwdField.type = pwdField.type === "password" ? "text" : "password";
            togglePwd.textContent =
                pwdField.type === "password" ? "üëÅÔ∏è" : "üôà";
        });

        /* ---------- KEYBOARD SHORTCUTS ---------- */
        document.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
                form.requestSubmit();
            }
            if (e.key === "Escape") form.reset();
        });

        /* ---------- CONNECTION POLL ---------- */
        pingBackend();
        setInterval(pingBackend, 30000);
    </script>
</body>
</html>
